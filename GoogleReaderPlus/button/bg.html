<html>
    <head>
        <title>ReaderPlus Button</title>
        <script type="application/javascript" src="version.js"></script>
        <script type="application/javascript" src="lib/greasekit.js"></script>
        <script type="application/javascript" src="lib/cross.js"></script>
        <script type="application/javascript" src="lib/external.js"></script>
        <script type="text/javascript" src="chrome_ex_oauthsimple.js"></script>
        <script type="text/javascript" src="chrome_ex_oauth.js"></script>
        <script type="application/javascript">
            var SIGNED_OUT_BADGE_COLOR_ = {
                color: [190, 190, 190, 230]
            };
            var SIGNED_IN_BADGE_COLOR_ = {
                color: [208, 0, 24, 255]
            };
            
            function isObjectEmpty(o){
                if (!o) {
                    return true;
                }
                for (var p in o) {
                    if (!hasOwnProperty.call(o, p)) {
                        continue;
                    }
                    return false;
                }
                return true;
            }
            
            var prefs;
            function getPref(option){
                if (!prefs || isObjectEmpty(prefs)) {
                    prefs = GM_getValue('iconprefs', {});
                }
                if (typeof prefs[option] !== "undefined") {
                    return prefs[option];
                } else {
                    return false;
                }
            }
            
            function updateIcon(logged, text){
                chrome.browserAction.setIcon({
                    path: (logged) ? 'images/19.png' : 'images/19-gray.png'
                });
                chrome.browserAction.setBadgeBackgroundColor((logged) ? SIGNED_IN_BADGE_COLOR_ : SIGNED_OUT_BADGE_COLOR_);
                
                if (text) {
                    chrome.browserAction.setBadgeText({
                        text: text
                    });
                    
                }
            }
            
            chrome.extension.onRequestExternal.addListener(function(request, sender, sendResponse){
                if (sender.id === GUID_CORE && request.message) {
                    if (request.message === 'updateicon') {
                        var a = request.options;
                        if (a) {
                            updateIcon(a.logged, a.text);
                        }
                    } else if (request.message === 'version') {
                        console.log('version: ' + GRPP.VERSION);
                        sendResponse(window.GRPP.VERSION);
                    } else if (request.message === 'prefs') {
                        GM_setValue('iconprefs', request.options.prefs);
                    }
                }
            });
        </script>
		<script type="text/javascript" src="contacts.js"></script>
    </head>
    <body>
    </body>
</html>
