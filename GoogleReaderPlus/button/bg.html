<html>
    <head>
        <title>GoogleReaderPlus Icon Background</title>
        <script type="application/javascript" src="version.js">
        </script>
        <script type="application/javascript" src="lib/external.js">
        </script>
        <script type="application/javascript">
            var SIGNED_OUT_BADGE_COLOR_ = 
            {
                color: [190, 190, 190, 230]
            };
            var SIGNED_IN_BADGE_COLOR_ = 
            {
                color: [208, 0, 24, 255]
            };
			
			var prefs;
			function getPref(option){
				if (prefs && typeof prefs[option] !== "undefined"){
					return prefs[option];
				}else{
					return false;
				}
			}
			
			function updateIcon(logged, text){
                chrome.browserAction.setIcon(
                {
                    path: (logged) ? 'images/19.png' : 'images/19-gray.png'
                });
                chrome.browserAction.setBadgeBackgroundColor((logged) ? SIGNED_IN_BADGE_COLOR_ : SIGNED_OUT_BADGE_COLOR_);
                
                if (text) {
                    chrome.browserAction.setBadgeText(
                    {
                        text: text
                    });
                    
                }
            }
            
            chrome.extension.onRequestExternal.addListener(function(request, sender, sendResponse){
                if (sender.id === GUID_CORE && request.message) {
                    if (request.message === 'updateicon') {
                        var a = request.options;
                        if (a) {
                            updateIcon(a.logged, a.text);
                        }
                    } else if (request.message === 'version') {
                        console.log('version: ' + GRPP.VERSION);
                        sendResponse(window.GRPP.VERSION);
                    }else if (request.message === 'prefs') {
                        prefs=request.options.prefs;
                    }
                }
            });
        </script>
    </head>
    <body>
    </body>
</html>
